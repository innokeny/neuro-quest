# neuro-quest

## Векторная база данных (Vector Store)

В проекте используется векторная база данных для хранения и поиска релевантного контекста игровых сессий. Это позволяет чат-боту Dungeon Master автоматически подбирать важные исторические события и детали, связанные с текущим запросом пользователя.

### Назначение
- Хранение истории игровых сессий (действия пользователя, ответы ассистента, события мира и т.д.)
- Быстрый поиск и извлечение релевантного контекста по смыслу (например, если игрок снова заходит в таверну, бот вспомнит, что ранее там что-то произошло)

### Технологии
- **FAISS** — быстрый поиск по векторам (Facebook AI Similarity Search)
- **Sentence Transformers** — преобразование текста в векторные представления
- **Pydantic** — строгие схемы для хранения данных

### Где хранятся данные?
- Все данные векторной базы сохраняются на диск в папке `data/vector_store/`:
  - `index.faiss` — бинарный индекс FAISS
  - `entries.json` — тексты, метаданные и временные метки

### Пример использования
```python
from src.memory.vector_store import VectorStore

# Инициализация
vector_store = VectorStore()

# Добавление событий
vector_store.add_entry("Ранее игрок украл монету в этой таверне", {"type": "historical_event"})
vector_store.add_entry("В таверне сидит пьяный гном", {"type": "scene_description"})

# Получение релевантного контекста для нового запроса
user_query = "Я зашел в таверну"
context = vector_store.get_context(user_query)
print(context)
# Выведет:
# Ранее игрок украл монету в этой таверне
# В таверне сидит пьяный гном
```

### Как работает поиск?
1. Каждый текст преобразуется в вектор с помощью Sentence Transformers.
2. Все векторы хранятся в FAISS-индексе.
3. При новом запросе его текст также преобразуется в вектор, и FAISS ищет наиболее близкие по смыслу записи.
4. Возвращается текстовое описание найденных событий — это и есть контекст для LLM.

### Как запускать тесты
1. Установите зависимости:
   ```bash
   pip install -e .
   ```
2. Запустите тесты:
   ```bash
   pytest src/tests/test_vector_store.py -v
   ```

### Примечания
- Векторная база автоматически сохраняет и загружает данные между сессиями.
- Для ускорения поиска и повышения качества можно использовать другие модели Sentence Transformers или дообучить их на своих данных.
- Для изоляции тестов используется временная директория.
